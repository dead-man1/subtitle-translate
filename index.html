<!DOCTYPE html>
<html lang="en" class="h-full dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subtitle Translator - AI-Powered Translation Tool</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 900: '#1e3a8a' },
                        accent: { 500: '#8b5cf6', 600: '#7c3aed' },
                        step: { active: '#3b82f6', inactive: '#9ca3af', complete: '#16a34a' }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .dark .glass-effect {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .progress-fill {
            transition: width 0.3s ease-in-out;
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        .dark .card-hover:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        details>summary {
            list-style: none;
        }

        details>summary::-webkit-details-marker {
            display: none;
        }

        .details-arrow {
            transition: transform 0.3s;
        }

        details[open] .details-arrow {
            transform: rotate(180deg);
        }

        /* Step Wizard Styles */
        [data-step] {
            display: none;
        }

        [data-step].active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        .step-line {
            transition: background-color 0.4s ease-in-out;
        }
    </style>
</head>

<body class="h-full bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Background Pattern -->
    <div class="fixed inset-0 -z-10">
        <div
            class="absolute inset-0 bg-gradient-to-br from-primary-50/20 to-accent-50/20 dark:from-gray-800/20 dark:to-gray-900/20">
        </div>
        <div class="absolute inset-0 opacity-30" style="background-image: url('data:image/svg+xml,%3Csvg width=" 60"
            height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg" %3E%3Cg fill="none" fill-rule="evenodd"
            %3E%3Cg fill="%239C92AC" fill-opacity="0.1" %3E%3Cpath
            d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"
            /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
    </div>

    <!-- Main Container -->
    <div class="relative z-10 min-h-full flex flex-col">
        <!-- Header -->
        <header
            class="sticky top-0 z-20 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm shadow-sm border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-gradient-to-r from-primary-600 to-accent-600 flex items-center justify-center">
                            <i class="fas fa-language text-white text-lg"></i>
                        </div>
                        <div>
                            <h1 id="page-title"
                                class="text-2xl font-bold bg-gradient-to-r from-primary-600 to-accent-600 bg-clip-text text-transparent">
                                Subtitle Translator</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400">AI-Powered Translation</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="languageToggle"
                            class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"
                            title="Toggle language (English/Persian)"><i
                                class="fas fa-language text-gray-600 dark:text-gray-300 group-hover:text-primary-600"></i></button>
                        <button id="clear-memory-button"
                            class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"
                            title="Clear translation memory"><i
                                class="fas fa-trash text-gray-600 dark:text-gray-300 group-hover:text-red-600"></i></button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
            <div id="form-container">
                <div class="text-center mb-8 animate-fade-in">
                    <h2 class="text-3xl font-bold mb-2">Translate Subtitles in 3 Easy Steps</h2>
                    <p id="upload-instructions" class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
                        Follow the steps below to get your subtitles translated by AI.</p>
                </div>

                <!-- Step Navigator -->
                <nav aria-label="Progress" class="mb-12">
                    <ol role="list" class="space-y-4 md:flex md:space-x-8 md:space-y-0">
                        <li class="md:flex-1">
                            <div id="step-1-indicator"
                                class="group flex flex-col border-l-4 border-primary-600 py-2 pl-4 md:border-l-0 md:border-t-4 md:pl-0 md:pt-4 md:pb-0">
                                <span class="text-sm font-medium text-primary-600">Step 1</span>
                                <span class="text-sm font-medium">API Setup</span>
                            </div>
                        </li>
                        <li class="md:flex-1">
                            <div id="step-2-indicator"
                                class="group flex flex-col border-l-4 border-gray-200 py-2 pl-4 md:border-l-0 md:border-t-4 md:pl-0 md:pt-4 md:pb-0 dark:border-gray-700">
                                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Step 2</span>
                                <span class="text-sm font-medium">Add Content</span>
                            </div>
                        </li>
                        <li class="md:flex-1">
                            <div id="step-3-indicator"
                                class="group flex flex-col border-l-4 border-gray-200 py-2 pl-4 md:border-l-0 md:border-t-4 md:pl-0 md:pt-4 md:pb-0 dark:border-gray-700">
                                <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Step 3</span>
                                <span class="text-sm font-medium">Translate</span>
                            </div>
                        </li>
                    </ol>
                </nav>


                <!-- Main Form -->
                <form id="translate-form" class="space-y-6">
                    <!-- Step 1: API Key -->
                    <section id="step-1" data-step
                        class="active bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 card-hover">
                        <h3 class="text-xl font-bold mb-4 flex items-center"><i
                                class="fas fa-key mr-3 text-primary-600"></i>Step 1: Configure Your API Key</h3>
                        <div class="space-y-4">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                This tool uses the Gemini API. Please provide your API key to proceed. Your key is
                                stored locally in your browser and is never sent to our servers.
                            </p>
                            <div>
                                <label for="api_key"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Gemini API
                                    Key</label>
                                <div class="relative">
                                    <input type="password" id="api_key" name="api_key"
                                        class="w-full pl-4 pr-12 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700"
                                        placeholder="Enter your Gemini API key" required>
                                    <button type="button"
                                        class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-500 hover:text-gray-700"
                                        id="togglePasswordBtn" aria-label="Toggle API key visibility"><i
                                            class="fas fa-eye"></i></button>
                                </div>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="remember_me" name="remember_me"
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                                <label for="remember_me" class="ml-2 text-sm text-gray-700 dark:text-gray-300">Remember
                                    my key</label>
                            </div>
                            <div class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                <p class="text-sm text-blue-800 dark:text-blue-200">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Get your free key from <a href='https://aistudio.google.com/app/apikey'
                                        target='_blank' class="font-medium underline hover:text-blue-600">Google AI
                                        Studio</a>.
                                </p>
                            </div>
                        </div>
                        <div class="mt-8 text-right">
                            <button type="button" id="next-to-step-2"
                                class="px-6 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed">
                                Next <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </section>

                    <!-- Step 2: Input Method -->
                    <section id="step-2" data-step
                        class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 card-hover">
                        <h3 class="text-xl font-bold mb-4 flex items-center"><i
                                class="fas fa-upload mr-3 text-primary-600"></i>Step 2: Add Your Subtitle Content</h3>
                        <div class="flex justify-center mb-6">
                            <div class="inline-flex rounded-lg bg-gray-100 dark:bg-gray-700 p-1 space-x-1">
                                <button type="button" id="select-file-input"
                                    class="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-md shadow">File
                                    Upload</button>
                                <button type="button" id="select-text-input"
                                    class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-300 rounded-md">Paste
                                    Text</button>
                            </div>
                        </div>

                        <div id="file-input-container">
                            <div id="dropzone-upload"
                                class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:border-primary-400 transition-colors cursor-pointer bg-gray-50 dark:bg-gray-700/50">
                                <i class="fas fa-cloud-upload-alt text-5xl text-gray-400 mb-4"></i>
                                <p class="text-lg font-medium">Drag & drop SRT, VTT, SSA, or ASS file</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">or</p>
                                <div id="choose-file-btn"
                                    class="inline-block px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 cursor-pointer">
                                    Choose File</div>
                            </div>
                            <div id="file-feedback" class="mt-4 text-center" style="display: none;">
                                <p class="text-green-600 dark:text-green-400 font-medium"><i
                                        class="fas fa-check-circle mr-2"></i>File selected: <span id="file-name"
                                        class="font-bold"></span></p>
                                <button type="button" id="remove-file"
                                    class="text-sm text-red-500 hover:underline ml-4"><i
                                        class="fas fa-times-circle mr-1"></i>Remove</button>
                            </div>
                        </div>

                        <div id="text-input-container" style="display: none;">
                            <textarea id="srt_text" name="srt_text" rows="8"
                                class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 focus:ring-2 focus:ring-primary-500"
                                placeholder="Paste your SRT content here..."></textarea>
                            <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">Note: Only SRT format is supported
                                for text input.</p>
                        </div>

                        <div class="mt-8 flex justify-between items-center">
                            <button type="button" id="back-to-step-1"
                                class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 font-semibold rounded-lg hover:bg-gray-300 transition-all">
                                <i class="fas fa-arrow-left mr-2"></i> Back
                            </button>
                            <button type="button" id="next-to-step-3"
                                class="px-6 py-2 bg-primary-600 text-white font-semibold rounded-lg shadow-md hover:bg-primary-700 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed">
                                Next <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </section>

                    <!-- Step 3: Settings & Translate -->
                    <section id="step-3" data-step
                        class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 sm:p-8 card-hover">
                        <h3 class="text-xl font-bold mb-6 flex items-center"><i
                                class="fas fa-cogs mr-3 text-primary-600"></i>Step 3: Finalize and Translate</h3>

                        <div class="space-y-6">
                            <div>
                                <label for="lang-input"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target
                                    Language</label>
                                <input type="text" id="lang-input" name="lang" value="Persian (Farsi)"
                                    class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 focus:ring-2 focus:ring-primary-500"
                                    placeholder="e.g., Spanish, French, Japanese" required>
                            </div>

                            <details class="bg-gray-50 dark:bg-gray-900/50 rounded-lg border dark:border-gray-700">
                                <summary class="p-4 cursor-pointer flex justify-between items-center">
                                    <h4 class="text-md font-semibold flex items-center"><i
                                            class="fas fa-tools mr-2 text-gray-500"></i>Advanced Settings</h4>
                                    <i class="fas fa-chevron-down text-gray-500 details-arrow"></i>
                                </summary>
                                <div class="px-4 pb-4 border-t dark:border-gray-700">
                                    <!-- This is where the original Advanced Settings HTML goes. It has been copied here directly. -->
                                    <div class="pt-4 space-y-6">
                                        <div
                                            class="p-3 bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-800 rounded-lg">
                                            <div class="flex items-start">
                                                <i class="fas fa-exclamation-triangle text-amber-500 mt-0.5 mr-2"></i>
                                                <p class="text-sm text-amber-800 dark:text-amber-200">Adjusting these
                                                    settings can affect performance, cost, and quality. Proceed with
                                                    caution.</p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            <div>
                                                <label for="model"
                                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">AI
                                                    Model</label>
                                                <select id="model" name="model"
                                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700">
                                                    <option value="gemini-2.5-flash-preview-04-17">Gemini 2.5 Flash
                                                    </option>
                                                    <option value="gemini-2.0-flash" selected>Gemini 2.0 Flash</option>
                                                    <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash-Lite</option>
                                                    <option value="gemini-2.5-pro-preview-03-25">Gemini 2.5 Pro</option>
                                                    <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
                                                    <option value="gemini-1.5-flash-8b">Gemini 1.5 Flash-8B</option>
                                                    <option value="gemini-1.5-pro">Gemini 1.5 Pro</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="temperature"
                                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Temperature
                                                    <span class="text-gray-400 text-xs">(creativity)</span></label>
                                                <input type="number" id="temperature" name="temperature" min="0" max="2"
                                                    step="0.1" value="0.7"
                                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700">
                                            </div>
                                        </div>
                                        <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                                            <div class="flex items-center">
                                                <input type="checkbox" id="useProxyCheckbox" name="useProxyCheckbox"
                                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                                                <label for="useProxyCheckbox"
                                                    class="ml-2 text-sm text-gray-700 dark:text-gray-300">Use Proxy (For
                                                    users in sanctioned regions)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                        <div class="mt-8 flex justify-between items-center">
                            <button type="button" id="back-to-step-2"
                                class="px-6 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 font-semibold rounded-lg hover:bg-gray-300 transition-all">
                                <i class="fas fa-arrow-left mr-2"></i> Back
                            </button>
                            <button id="submit-button" type="submit"
                                class="px-8 py-3 bg-gradient-to-r from-primary-600 to-accent-600 text-white font-semibold rounded-lg shadow-lg transform hover:scale-105 transition-all focus:outline-none focus:ring-4 focus:ring-primary-500/50">
                                <span class="button-text flex items-center justify-center">
                                    <i class="fas fa-language mr-2"></i> Translate Now
                                </span>
                                <span class="button-spinner" style="display: none;">
                                    <div class="spinner"></div>
                                </span>
                            </button>
                        </div>
                    </section>
                </form>
            </div>

            <!-- Progress & Results Area -->
            <div id="results-area" class="mt-8 animate-slide-up" style="display: none;">

                <!-- Progress Display (This part remains) -->
                <div id="progress-container" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center"><i
                            class="fas fa-tasks mr-2 text-primary-600 animate-pulse-slow"></i><span
                            data-i18n="progressTitle">Translation in Progress...</span></h3>
                    <div class="flex justify-between text-sm mb-1">
                        <span id="progress-text">0% Complete</span>
                        <span id="time-estimate">Estimating...</span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3.5">
                        <div id="progress"
                            class="progress-fill bg-gradient-to-r from-primary-500 to-accent-500 h-full rounded-full"
                            style="width: 0%"></div>
                    </div>
                    <div id="chunk-status" class="text-sm text-gray-600 dark:text-gray-400 mt-2">Initializing...</div>
                </div>

                <!-- Error Message (This part remains) -->
                <div id="error-message" class="mt-6 p-4 rounded-xl" style="display: none;">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-circle text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-md font-bold">An Error Occurred</h3>
                            <div id="error-content" class="text-sm mt-2"></div>
                        </div>
                    </div>
                </div>

                <!-- NEW: Side-by-Side Editor Container -->
                <div id="editor-container" class="mt-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg"
                    style="display: none;">
                    <!-- Editor Header -->
                    <div
                        class="p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col sm:flex-row justify-between items-center gap-4">
                        <h3 class="text-xl font-bold text-gray-800 dark:text-gray-200">
                            <i class="fas fa-edit mr-2 text-primary-500"></i>
                            Edit Your Translation
                        </h3>
                        <div class="flex items-center gap-3">
                            <button id="download-edited-btn"
                                class="inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-all">
                                <i class="fas fa-download mr-2"></i>
                                <span data-i18n="downloadFile">Download File</span>
                            </button>
                            <button id="start-new-from-editor-btn"
                                class="inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg transition-all">
                                <i class="fas fa-plus-circle mr-2"></i>
                                <span data-i18n="startNew">Start New</span>
                            </button>
                        </div>
                    </div>
                    <!-- Editor Table -->
                    <div class="overflow-x-auto max-h-[60vh] overflow-y-auto">
                        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                            <thead
                                class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-0">
                                <tr>
                                    <th scope="col" class="px-4 py-3 w-12 text-center">#</th>
                                    <th scope="col" class="px-6 py-3">Original Text</th>
                                    <th scope="col" class="px-6 py-3">Translated Text (Editable)</th>
                                </tr>
                            </thead>
                            <tbody id="editor-tbody">
                                <!-- Rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer
            class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-t border-gray-200 dark:border-gray-700 mt-12">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 md:mb-0">
                        Created with <i class="fas fa-heart text-red-500 mx-1"></i> by
                        <a href="https://x.com/yebekhe" target="_blank" rel="noopener noreferrer"
                            class="font-medium text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300">
                            yebekhe
                        </a>
                    </p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Dropzone JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>
    <!-- Link to your custom JavaScript -->
    <script src="assets/script.js"></script>
</body>

</html>
